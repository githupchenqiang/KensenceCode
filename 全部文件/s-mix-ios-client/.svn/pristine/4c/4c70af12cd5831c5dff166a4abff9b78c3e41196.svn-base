//
//  SubsenceViewController.m
//  S-MixControl
//
//  Created by aa on 15/12/10.
//  Copyright © 2015年 KaiXingChuangDa. All rights reserved.
//

#import "SubsenceViewController.h"
#import "SignalValue.h"
#define KScreenWith self.view.frame.size.width
#define KScreenHeight self.view.frame.size.height
#define ScrollerWith  self.OutScroller.frame.size.width
#define ScrollerHeight self.OutScroller.frame.size.height
#define BackScrollerHight self.BackScroller.frame.size.height
#define BackSrollerWith   self.BackScroller.frame.size.width

@interface SubsenceViewController ()
@property (nonatomic ,strong)UILabel *Inlabel;
@property (nonatomic ,strong)UIScrollView *OutScroller;
@property (nonatomic ,strong)UIScrollView *BackScroller;
@property (nonatomic ,strong)NSMutableArray *labelArrat;
@property (nonatomic ,strong)NSMutableArray *mutArray;
@property (nonatomic ,strong)NSMutableArray *LostArray;
@end

@implementation SubsenceViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    
    [self SetUpScroller];
    [self SetUpLabel];
    _LostArray = [NSMutableArray array];
}

- (void)SetUpLabel
{
    for (int i = 0; i < [SignalValue ShareValue].Integer; i++) {
        for (int j = 0; j < 1; j++) {
            UILabel *Inlabel = [[UILabel alloc]initWithFrame:CGRectMake(0+BackSrollerWith/300*j,BackScrollerHight/20+ BackScrollerHight/9.5*i,BackSrollerWith/9,BackScrollerHight/13)];
            Inlabel.backgroundColor = [UIColor whiteColor];
            Inlabel.layer.masksToBounds = YES;
            Inlabel.layer.cornerRadius = 5;
            NSString *str = [NSString stringWithFormat:@"%d",i+1];
            Inlabel.text = str;
            Inlabel.layer.borderColor = [UIColor blackColor].CGColor;
            Inlabel.layer.borderWidth = 0.50f;
            Inlabel.font = [UIFont systemFontOfSize:23];
            Inlabel.textAlignment = NSTextAlignmentCenter;
            _OutScroller = [[UIScrollView alloc]initWithFrame:CGRectMake(CGRectGetWidth(_Inlabel.frame) * j +100, KScreenHeight/18 + KScreenHeight/10.6*i,KScreenWith/2,40)];
            
            _OutScroller.contentSize = CGSizeMake(ScrollerWith*[SignalValue ShareValue].Integer/9, ScrollerHeight);
            _OutScroller.layer.borderColor = [UIColor blackColor].CGColor;
            _OutScroller.layer.borderWidth = 0.50f;
            _OutScroller.layer.masksToBounds = YES;
            _OutScroller.layer.cornerRadius = 3;
            _OutScroller.showsVerticalScrollIndicator = YES;
            _OutScroller.scrollEnabled = YES;
            _OutScroller.tag = 500+i;
            [_BackScroller addSubview:_OutScroller];
            [_BackScroller addSubview:Inlabel];
            
        }
    }
    for (int i = 0; i < [SignalValue ShareValue].Integer; i++) {
        for (int j = 0; j < [SignalValue ShareValue].Integer; j++) {
            UILabel *ValueLabel = [[UILabel alloc]init];
            ValueLabel.frame = CGRectMake(10+ScrollerWith/9*j,5 ,ScrollerWith/8, 30);
            ValueLabel.tag = 3000+[SignalValue ShareValue].Integer*i+j;
            NSNumber *valueNumber = [NSNumber numberWithInteger:3000+9*i+j];
            [_labelArrat addObject:valueNumber];
            UIScrollView *scroller = (UIScrollView *)[self.view viewWithTag:500+i];
            [scroller addSubview:ValueLabel];
            
        }
    }
    //注册通知
    [[NSNotificationCenter defaultCenter]addObserver:self selector:@selector(reloadData:) name:@"Sence" object:nil];
    
    int t = 0;
    
    for (int i = 0; i < [SignalValue ShareValue].GetMessage.count; i++) {
        NSInteger num = t++;
        NSNumber *arrayNumber = [SignalValue ShareValue].GetMessage[i];
        NSInteger tagInteger = arrayNumber.integerValue;
        
        UILabel *label = (UILabel *)[self.view viewWithTag:((tagInteger -1)*[SignalValue ShareValue].Integer+3000) + num];
        NSString *str = [NSString stringWithFormat:@"%ld",(long)num + 1];
        label.text = str;
       
    }
}

//创建最底层的滚动视图
- (void)SetUpScroller
{
    _BackScroller = [[UIScrollView alloc]initWithFrame:CGRectMake(KScreenWith/240, KScreenHeight/20, KScreenWith/1.5,KScreenHeight -  KScreenHeight/10 - 5)];
    _BackScroller.contentSize = CGSizeMake(BackSrollerWith,BackScrollerHight * [SignalValue ShareValue].Integer/9);
    _BackScroller.showsVerticalScrollIndicator = NO;
   // _BackScroller.backgroundColor = [UIColor redColor];
    [self.view addSubview:_BackScroller];
    
}

- (void)reloadData:(NSNotification *)notic
{
    _mutArray = notic.userInfo[@"array"];
    
    //数据加载回到主线程
    dispatch_async(dispatch_get_main_queue(), ^{
        int t = 0;
        for (int i = 0; i < _mutArray.count; i++) {
            NSInteger num = t++;
            NSNumber *arrayNumber = _mutArray[i];
            NSInteger tagInteger = arrayNumber.integerValue;
            UILabel *label = (UILabel *)[self.view viewWithTag:((tagInteger -1)*[SignalValue ShareValue].GetMessage.count+3000) + num];
            NSString *str = [NSString stringWithFormat:@"%ld",(long)num + 1];
            label.text = str;
          
        }
    });

}

- (NSMutableArray *)mutArray
{
    if (_mutArray == nil) {
        _mutArray = [NSMutableArray array];
        
    }
    
    return _mutArray;
}

- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}

/*
#pragma mark - Navigation

// In a storyboard-based application, you will often want to do a little preparation before navigation
- (void)prepareForSegue:(UIStoryboardSegue *)segue sender:(id)sender {
    // Get the new view controller using [segue destinationViewController].
    // Pass the selected object to the new view controller.
}
*/

@end
